<div class="page-width">
  <div class="grid">
    <div data-section-id="{{ section.id }}" data-section-type="product" data-enable-history-state="true">

      {%- assign current_variant = product.selected_or_first_available_variant -%}
      {%- assign featured_image = current_variant.featured_image | default: product.featured_image -%}

      <div class="grid__item medium-up--one-half large-up--seven-twelfths">
        {% include 'product-images' %}
      </div>

      <div class="grid__item medium-up--one-half large-up--five-twelfths">
        <div class="product-meta">
          <div class="product-header">
            <h1 class="product-header__title h3">{{ product.title }}</h1>

            <div class="product-header__price">
              {% if product.compare_at_price_max > product.price %}
                <div class="compare_at_price" data-compare-price>
                  {% if current_variant.compare_at_price > current_variant.price %}
                    {{ current_variant.compare_at_price | money }}
                  {% endif %}
                </div>
                <div class="visually-hidden" data-compare-text>{{ 'products.product.regular_price' | t }}</div>
              {% endif %}

              <div data-product-price>
                {{ current_variant.price | money }}
              </div>

              {% unless product.metafields.stamped.reviews_count == blank %}
              <div class="review-info show sm-down--hide">
                <a id="readTheReviews">
                  <span class="stamped-product-reviews-badge stamped-main-badge" data-id="{{ product.id }}" data-product-sku="{{ product.handle }}" style="display: inline-block;">{{ product.metafields.stamped.badge }}</span> Reviews
                </a> 
                <a id="writeANewReview_new" class="hide" href="#stamped-main-widget">Write a review</a>
              </div>
              {% endunless %}

            </div>

          </div>

          {% include 'product-form' %}

          {% comment %} <a href="#!" class="product-form__size-guide js--size-guide">Size Guide</a> {% endcomment %}

          <div class="product-description">
            {% if product.description contains '%title-' %}
              {% include 'product-accordion' %}
            {% else %}
              {% include 'product-description' %}
            {% endif %}
          </div>

          {% if section.settings.enable_usp %}
            <div class="product-description__usp">
              {% if section.settings.usp_image != blank %}
                <img src="{{ section.settings.usp_image | img_url: '100x' }}" alt="{{ section.settings.usp_image.alt }}"/>
              {% endif %}
              {% if section.settings.usp_text %}
                <span>{{ section.settings.usp_text }}</span>
              {% endif %}
            </div>
          {% endif %}

      </div>
    </div>

    {% unless product == empty %}
      <script type="application/json" data-product-json>
        {{ product | json }}
      </script>
    {% endunless %}

    </div>

  </div>
</div>

{% if section.settings.show_size_guide %} 
  {% include 'size-guide' %}
{% endif %}


{% schema %}
  {
    "name": "Product pages",
    "settings": [
      {
        "type": "header",
        "content": "Form USP"
      },
      {
        "type": "checkbox",
        "id": "enable_usp",
        "label": "Enable USP",
        "default": true
      },
      {
        "type": "image_picker",
        "id": "usp_image",
        "label": "USP Image"
      },
      {
        "type": "text",
        "id": "usp_text",
        "label": "USP text"
      }
    ]
  }
{% endschema %}
