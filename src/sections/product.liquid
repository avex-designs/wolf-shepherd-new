<div class="page-width" js-swatch-product="main">
  <div class="grid">
    <div data-section-id="{{ section.id }}" data-section-type="product" data-enable-history-state="true">

      {%- assign current_variant = product.selected_variant  -%}
      {%- assign featured_image = current_variant.featured_image | default: product.featured_image -%}
      <div class="visually-hidden" id="current_selected_variant">{{ product.selected_variant.id }}</div>
      <div class="grid__item medium-up--one-half large-up--seven-twelfths product-images__mobile-container">
        {% include 'product-header' %}
        {% include 'product-images' %}
      </div>

      <div class="grid__item medium-up--one-half large-up--five-twelfths product-meta__container">
        <div class="product-meta">
          
          {% include 'product-header' %}
          {% include 'product-form' %}

          <div class="product-description">
            {% include 'product-accordion' %}
          </div>

          {% if section.settings.enable_usp %}
            <div class="product-description__usp">
              {% if section.settings.usp_image != blank %}
                <img src="{{ section.settings.usp_image | img_url: '100x' }}" alt="{{ section.settings.usp_image.alt }}"/>
              {% endif %}
              {% if section.settings.usp_text %}
                <span>{{ section.settings.usp_text }}</span>
              {% endif %}
            </div>
          {% endif %}

      </div>
    </div>

    {% unless product == empty %}
      <script type="application/json" id="product" data-product-json>
        {{ product | json }}
      </script>
      <script id="productInventory" data-inventory-json type="application/json"></script>
      <script>
     	let product = document.querySelector('#product').textContent;
        let productJson = product && JSON.parse(product)
        let output = ''
        productJson && productJson.variants.forEach(item => {
          	
        let cst = `window.ProductInventoryJSON[${item.id}] = {
            available: ${item.available},
            id: ${item.id},
            incoming: ${item.incoming},
            inventory_quantity: ${item.inventory_quantity},
        }`            
           return output +=  '\n' + cst
        });
        document.querySelector('#productInventory').textContent = output
      </script>
      
    {% endunless %}


    </div>

  </div>
</div>

{% include 'size-guide' %}

{% schema %}
  {
    "name": "Product pages",
    "settings": [
      {
        "type": "header",
        "content": "Form USP"
      },
      {
        "type": "checkbox",
        "id": "enable_usp",
        "label": "Enable USP",
        "default": true
      },
      {
        "type": "image_picker",
        "id": "usp_image",
        "label": "USP Image"
      },
      {
        "type": "text",
        "id": "usp_text",
        "label": "USP text"
      }
    ]
  }
{% endschema %}
<script>

const queryString = window.location.search
const urlParams = new URLSearchParams(queryString)
const variant = urlParams.get('variant')
if(!variant){
 
  let swatches = document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-2');
  if(swatches){
    swatches.querySelectorAll('button').forEach(it => {
          it.classList.remove('is-active')
    })
  }
  
  let swatches_opt3 = document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-3');
  if(swatches_opt3){
    swatches_opt3.querySelectorAll('button').forEach(it => {
          it.classList.remove('is-active')
    })
  }
  
}

document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-1').addEventListener('click', (event) => {
  const isButton = event.target.nodeName === 'BUTTON';
  if (!isButton) {
    return;
  }
  
  document.querySelector('#shopify-section-product').querySelector('.swatch__size-container__title-trigger').innerHTML = 'SELECT SIZE'
})

</script>

{% comment %} <script>
document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-1').addEventListener('click', (event) => {
  const isButton = event.target.nodeName === 'BUTTON';
  if (!isButton) {
    return;
  }
  
  document.querySelector('#shopify-section-product').querySelector('.swatch__size-container__title-trigger').innerHTML = 'SELECT SIZE'

  if(document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-2')){
    document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-2').querySelectorAll('button').forEach(it => {
      it.classList.remove('is-active')
      //it.classList.remove('is-disabled')
    })
  }
  
  if(document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-3')){
    document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-3').querySelectorAll('button').forEach(it => {
        it.classList.remove('is-active')
        //it.classList.remove('is-disabled')
    })
  }  
})

document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-2').addEventListener('click', (event) => {
  const isButton = event.target.nodeName === 'BUTTON';
  if (!isButton) {
    return;
  }
  if(document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-3')){
    document.querySelector('#shopify-section-product').querySelector('.swatch__wrapper.option-3').querySelectorAll('button').forEach(it => {
      it.classList.remove('is-active')
      //it.classList.remove('is-disabled')
    })
  }  
})
</script> {% endcomment %}