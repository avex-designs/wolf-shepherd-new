<nav class="site-header__nav site-header__mobile-hide" role="navigation">
  <ul class="site-nav">
    {% for link in linklists[section.settings.main_linklist].links %}
      {% assign meganav = false %}
      {% comment %}
      ------------------------------------------------------------------------------
        Has meganav
      ------------------------------------------------------------------------------
      {% endcomment %}
      {% for block in section.blocks %}
        {%- if block.settings.navlink_bind == link.title  -%}
          {% assign meganav = true %}
          <li class="site-nav__item site-nav__item--has-meganav {% if link.active %}site-nav__link--active{% endif %}" js-mega-nav="desktop-nav">
            <a class="site-nav__link" href="{{ link.url }}">
              {{ link.title }}
            </a>
            {% include 'meganav' %}
          </li>
        {%- endif -%}  
      {% endfor %}

      {% comment %}
      ------------------------------------------------------------------------------
        0 levels
      ------------------------------------------------------------------------------
      {% endcomment %}
      {% if link.levels == 0 and meganav != true %}
        <li class="site-nav__item" data-meganav-parent="{{ link.title | handle }}">
          <a class="site-nav__link {% if link.active %}site-nav__link--active{% endif %}" href="{{ link.url }}">
            {{ link.title }}
          </a>
        </li>

      {% comment %}
      ------------------------------------------------------------------------------
        1 level
      ------------------------------------------------------------------------------
      {% endcomment %}
      {% elsif link.levels == 1 and meganav != true %}
        <li class="site-nav__item site-nav__item--has-dropdown" data-meganav-parent="{{ link.title | handle }}">
          <a class="site-nav__link {% if link.active %}site-nav__link--active{% endif %}" href="{{ link.url }}">
            {{ link.title }}
          </a>

          <ul class="site-nav__dropdown navlist navlist--block">
            {% for child_link in link.links %}
              <li class="navlist__item">
                <a class="navlist__link {% if link.active %}navlist__link--active{% endif %}" href="{{ child_link.url }}">
                  {{ child_link.title }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
</nav>